# BingX Telegram Signal Trading Bot

Цей проєкт являє собою автоматизовану торгову систему для криптовалютної біржі BingX, яка працює на основі сигналів з Telegram-каналів.

## Опис

Система використовує Telegram-бота для моніторингу вказаного цільового чату, куди вручну пересилаються торгові сигнали з різних джерел (каналів). Бот аналізує ці переслані повідомлення, ідентифікує вихідний канал за назвою, парсить текст сигналу відповідно до налаштувань для цього каналу, та автоматично виконує торгові операції на біржі BingX (відкриття ринкових або лімітних ордерів, встановлення стоп-лосс та тейк-профіт ордерів).

Бот також відстежує відкриті позиції та їхні SL/TP ордери в базі даних SQLite та використовує `PositionManager` для моніторингу та потенційного управління позиціями (наприклад, переміщення стоп-лоссу в беззбиток, хоча ця логіка може бути ще не повністю реалізована).

## Основні компоненти

- `main.py`: Головний скрипт запуску, координації компонентів та обробки повідомлень.
- `telegram_monitor.py`: Налаштування та запуск Telegram-бота для отримання повідомлень.
- `signal_interpreter.py`: Парсинг та інтерпретація текстів сигналів з різних джерел.
- `bingx_client.py`: Взаємодія з API біржі BingX (через бібліотеку `ccxt`).
- `data_manager.py`: Функції для роботи з базою даних SQLite (ініціалізація, додавання, оновлення, отримання позицій).
- `position_manager.py`: Клас для моніторингу активних позицій та управління ними (поточна реалізація може бути базовою).
- `config.json`: Файл конфігурації (параметри торгівлі для кожного каналу, ліміти, загальний банкрол).
- `.env`: Зберігання чутливих даних (API ключі BingX, токен Telegram бота, ID цільового чату Telegram).
- `positions.sqlite`: Файл бази даних SQLite для відстеження відкритих позицій та пов'язаних ордерів.
- `requirements.txt`: Список залежностей Python з конкретними версіями для уникнення проблем сумісності.
- `bot.log`: Файл логів, де зберігається детальна інформація про роботу бота (рівень DEBUG).
- `run_background.bat`: Скрипт для запуску бота, який також очищує старі логи для збереження дискового простору.

## Нові функції та покращення

- **Автоматична ротація логів**: Логи автоматично розділяються по днях та зберігаються протягом 7 днів
- **Очищення старих логів**: Скрипт `run_background.bat` автоматично видаляє логи старші 7 днів
- **Зменшене кредитне плече**: Для деяких каналів зменшено кредитне плече з 25 до 15 для зниження ризиків
- **Файл .gitignore**: Додано для запобігання потрапляння чутливих даних та тимчасових файлів до репозиторію

## Встановлення та запуск

1.  **Клонуйте репозиторій:**
    ```bash
    git clone <repository_url>
    cd <repository_directory>
    ```
2.  **Створіть та активуйте віртуальне середовище (рекомендовано):**
    ```bash
    python -m venv venv
    # Linux/macOS:
    source venv/bin/activate
    # Windows:
    # venv\Scripts\activate
    ```
3.  **Встановіть залежності:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Налаштуйте конфігурацію:**
    - Створіть файл `.env` в кореневій папці проєкту та додайте туди наступні змінні:
      ```dotenv
      BINGX_API_KEY="ВАШ_API_KEY_BINGX"
      BINGX_API_SECRET="ВАШ_API_SECRET_BINGX"
      TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН_TELEGRAM_БОТА"
      TELEGRAM_TARGET_CHAT_ID="ID_ВАШОГО_ЦІЛЬОВОГО_ЧАТУ"
      ```
      _(Примітка: `TELEGRAM_TARGET_CHAT_ID` - це ID чату, куди ви будете пересилати сигнали, і де бот буде їх читати)._
    - Перегляньте та відредагуйте файл `config.json`:
      - В секції `global_settings` вкажіть `total_bankroll`.
      - В секції `channels` налаштуйте параметри для кожного каналу, з якого ви плануєте пересилати сигнали (назва каналу має точно співпадати з тією, що показує Telegram при пересиланні), `entry_percentage`, `tp_distribution`, `leverage`.
      - В секції `position_limits` налаштуйте ліміти одночасно відкритих позицій для груп каналів.
5.  **Запустіть бота:**

    ```bash
    # На Windows просто запустіть:
    run_background.bat

    # Або через Python безпосередньо:
    python main.py
    ```

    Бот почне роботу, виведе інформацію про логування в консоль та у файл `bot.log`. Логи в консолі показуватимуть основні події та помилки (рівень INFO), тоді як файл `bot.log` міститиме всю детальну інформацію (рівень DEBUG).

## Робота з ботом

Після запуску, просто пересилайте повідомлення з торговими сигналами (з каналів, що налаштовані в `config.json`) у ваш цільовий чат (`TELEGRAM_TARGET_CHAT_ID`). Бот автоматично їх обробить.

## Важливі примітки

- Торгівля криптовалютами пов'язана з високими ризиками. Використовуйте цього бота на свій страх і ризик.
- Переконайтеся, що логіка парсингу в `signal_interpreter.py` відповідає формату сигналів у ваших каналах.
- Регулярно перевіряйте логи (`bot.log`) для моніторингу роботи та виявлення потенційних проблем.
- Поточна реалізація `position_manager.py` може потребувати доопрацювання для складних стратегій управління позиціями.

## Додавання нового каналу сигналів

Щоб додати підтримку нового каналу, з якого ви хочете пересилати сигнали, виконайте наступні кроки:

1.  **Налаштуйте `config.json`:**

    - У секції `channels` додайте новий об'єкт. Ключ має бути унікальним (напр., `"channel_5"`).
    - Вкажіть точну `name` каналу, як вона відображається в Telegram.
    - Встановіть параметри `entry_percentage`, `tp_distribution` (кількість елементів має відповідати очікуваній кількості TP у сигналах), `leverage`.
    - Приклад:
      ```json
      "channel_5": {
        "name": "Назва Нового Каналу",
        "entry_percentage": 5,
        "tp_distribution": [50, 50],
        "leverage": 15
      }
      ```
    - За потреби оновіть ліміти у секції `position_limits`.

2.  **Створіть парсер в `signal_interpreter.py`:**

    - Додайте нову функцію, наприклад, `parse_channel_5(text: str, config: dict)`.
    - Реалізуйте логіку парсингу тексту сигналів _саме цього_ каналу за допомогою регулярних виразів.
    - Функція має витягувати `pair`, `direction`, `stop_loss` (обов'язково), `take_profits` (список, під ключем `"take_profits"`) та інші дані.
    - Функція має повертати словник `signal_data` в стандартному форматі (з ключем `"type": "full"` або іншим, якщо логіка інша).

3.  **Додайте обробник в `main.py`:**

    - У функції `handle_new_message` знайдіть блок `if/elif`, де обробляються `channel_key`.
    - Додайте новий блок: `elif channel_key == "channel_5":`.
    - Всередині цього блоку:
      - Викличте ваш новий парсер: `signal_data = signal_interpreter.parse_channel_5(signal_text, config)`.
      - Перевірте, чи `signal_data` отримано.
      - Реалізуйте логіку розміщення ордерів (ринкового/лімітного, SL, TP), аналогічно до інших каналів, використовуючи дані з `signal_data`.
      - Не забудьте отримати `tp_distribution` з `channel_config` на початку блоку `handle_new_message` або всередині цього `elif`.
      - Додайте логіку збереження позиції в базу даних через `data_manager.add_new_position`.

4.  **Перезапустіть бота**, щоб зміни набули чинності.
